# v47.14 Aggressive Bot Architecture

```
┌─────────────────────────────────────────────────────────────────────────┐
│                         TRADING BOT v47.14                              │
│                         (Aggressive Mode)                               │
└─────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────┐
│                            ENTRY LAYER                                  │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌───────────────────────────────────────────────────────────────┐    │
│  │  INSTANT SIGNALS (Existing)                                   │    │
│  ├───────────────────────────────────────────────────────────────┤    │
│  │  • Volatility Breakout                                        │    │
│  │  • UOA Entry                                                  │    │
│  │  • Trend Continuation                                         │    │
│  │  • MA Crossover                                               │    │
│  │  • Candle Patterns                                            │    │
│  └───────────────────────────────────────────────────────────────┘    │
│                              ↓                                          │
│  ┌───────────────────────────────────────────────────────────────┐    │
│  │  ENHANCED CROSSOVER TRACKER (NEW) 🎯                          │    │
│  ├───────────────────────────────────────────────────────────────┤    │
│  │  1. Detect Supertrend Flip                                    │    │
│  │  2. Create 5-min Tracking Signal                              │    │
│  │     • Primary Side (CE/PE)                                    │    │
│  │     • Alternative Side (opposite)                             │    │
│  │  3. Monitor Option Momentum                                   │    │
│  │  4. Check Price Rising (60% ticks)                            │    │
│  │  5. Check Acceleration (>2%)                                  │    │
│  │  6. Execute when aligned                                      │    │
│  └───────────────────────────────────────────────────────────────┘    │
│                              ↓                                          │
│  ┌───────────────────────────────────────────────────────────────┐    │
│  │  PERSISTENT TREND TRACKER (NEW) 📈                            │    │
│  ├───────────────────────────────────────────────────────────────┤    │
│  │  1. Monitor Established Trend                                 │    │
│  │  2. Detect Price Extensions                                   │    │
│  │     • Break above recent highs (CE)                           │    │
│  │     • Break below recent lows (PE)                            │    │
│  │  3. Create 3-min Continuation Signal                          │    │
│  │  4. Track Option Momentum                                     │    │
│  │  5. Validate with ATM Confirmation                            │    │
│  │  6. Execute on trend continuation                             │    │
│  └───────────────────────────────────────────────────────────────┘    │
│                              ↓                                          │
│  ┌───────────────────────────────────────────────────────────────┐    │
│  │  ADAPTIVE VALIDATION                                          │    │
│  ├───────────────────────────────────────────────────────────────┤    │
│  │  • STRICT: Continuations (full checks)                        │    │
│  │  • LENIENT: Reversals (bypass breakout filter) 🔄            │    │
│  │  • ATM Confirmation (always required)                         │    │
│  │  • Price Rising Check (3 ticks)                               │    │
│  │  • Momentum Check (index + option)                            │    │
│  │  • Acceleration Check (velocity increase)                     │    │
│  └───────────────────────────────────────────────────────────────┘    │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────┐
│                         EXECUTION LAYER                                 │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌───────────────────────────────────────────────────────────────┐    │
│  │  ORDER CHASING ENGINE (NEW) 🔄                                │    │
│  ├───────────────────────────────────────────────────────────────┤    │
│  │                                                               │    │
│  │  STEP 1: Fetch Market Depth                                  │    │
│  │  ├─→ Get best bid (for SELL)                                 │    │
│  │  └─→ Get best ask (for BUY)                                  │    │
│  │                                                               │    │
│  │  STEP 2: Place Limit Order                                   │    │
│  │  ├─→ At best bid/ask price                                   │    │
│  │  ├─→ Log order ID                                            │    │
│  │  └─→ Wait 200ms                                              │    │
│  │                                                               │    │
│  │  STEP 3: Check Fill Status                                   │    │
│  │  ├─→ FILLED? → Success! ✅                                   │    │
│  │  └─→ NOT FILLED?                                             │    │
│  │      ├─→ Cancel order                                        │    │
│  │      ├─→ Fetch new depth                                     │    │
│  │      └─→ Retry (up to 3x)                                    │    │
│  │                                                               │    │
│  │  STEP 4: Market Fallback                                     │    │
│  │  └─→ If all limit attempts fail                              │    │
│  │                                                               │    │
│  │  STEP 5: Verify Position                                     │    │
│  │  ├─→ Match? → Success! ✅                                    │    │
│  │  └─→ Mismatch? → Cleanup! ⚠️                                │    │
│  │                                                               │    │
│  │  BENEFIT: 0.5-2 points better fills                          │    │
│  │                                                               │    │
│  └───────────────────────────────────────────────────────────────┘    │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────┐
│                           EXIT LAYER                                    │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌───────────────────────────────────────────────────────────────┐    │
│  │  LAYER 1: RED CANDLE EXIT (NEW) 🔴                           │    │
│  ├───────────────────────────────────────────────────────────────┤    │
│  │  • Check on EVERY tick                                        │    │
│  │  • Condition: LTP < Option Candle Open                        │    │
│  │  • Action: INSTANT EXIT (no delay)                            │    │
│  │  • Priority: HIGHEST (before all other exits)                 │    │
│  │  • Benefit: Protects profits early                            │    │
│  └───────────────────────────────────────────────────────────────┘    │
│                              ↓                                          │
│  ┌───────────────────────────────────────────────────────────────┐    │
│  │  LAYER 2: PROFIT TARGET                                       │    │
│  ├───────────────────────────────────────────────────────────────┤    │
│  │  • User-defined rupee target                                  │    │
│  │  • Full exit when hit                                         │    │
│  └───────────────────────────────────────────────────────────────┘    │
│                              ↓                                          │
│  ┌───────────────────────────────────────────────────────────────┐    │
│  │  LAYER 3: MULTIPLE PARTIAL EXITS (NEW) 📊                    │    │
│  ├───────────────────────────────────────────────────────────────┤    │
│  │  • Level 1: 20% profit → Exit 50%                             │    │
│  │  • Level 2: 40% profit → Exit 50% of remaining                │    │
│  │  • Level 3: 60% profit → Exit 50% of remaining                │    │
│  │  • Continue until qty < lot_size                              │    │
│  │  • Benefit: Lock in gains progressively                       │    │
│  └───────────────────────────────────────────────────────────────┘    │
│                              ↓                                          │
│  ┌───────────────────────────────────────────────────────────────┐    │
│  │  LAYER 4: SUSTAINED MOMENTUM SL                               │    │
│  ├───────────────────────────────────────────────────────────────┤    │
│  │  • Normal Mode: Standard trailing SL                          │    │
│  │  • Momentum Mode: Dynamic SL (candle low/high)                │    │
│  │  • Switches based on body expansion + structure               │    │
│  └───────────────────────────────────────────────────────────────┘    │
│                              ↓                                          │
│  ┌───────────────────────────────────────────────────────────────┐    │
│  │  LAYER 5: TRAILING SL                                         │    │
│  ├───────────────────────────────────────────────────────────────┤    │
│  │  • Points-based: max_price - points                           │    │
│  │  • Percent-based: max_price × (1 - pct/100)                   │    │
│  │  • Final safety net                                           │    │
│  └───────────────────────────────────────────────────────────────┘    │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────┐
│                      CONTINUOUS MONITORING                              │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  On EVERY TICK (when no position):                                     │
│  ├─→ crossover_tracker.enhanced_signal_monitoring()                    │
│  ├─→ trend_tracker.check_extended_trend_continuation()                 │
│  └─→ trend_tracker.monitor_trend_signals()                             │
│                                                                         │
│  On NEW CANDLE:                                                         │
│  ├─→ crossover_tracker.detect_all_crossovers()                         │
│  └─→ crossover_tracker.create_tracking_signals()                       │
│                                                                         │
│  On TICK (with position):                                              │
│  ├─→ check_partial_profit_take()                                       │
│  └─→ evaluate_exit_logic()                                             │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────┐
│                        DATA FLOW                                        │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  Kite Ticker                                                            │
│       ↓                                                                 │
│  handle_ticks_async()                                                   │
│       ↓                                                                 │
│  Price Updates                                                          │
│       ↓                                                                 │
│  Candle Updates                                                         │
│       ↓                                                                 │
│  ┌─────────────────────┐                                               │
│  │  NO POSITION?       │                                               │
│  └─────────────────────┘                                               │
│       ↓                                                                 │
│  ┌─────────────────────────────────────────────────┐                   │
│  │  • Check Instant Signals                        │                   │
│  │  • Monitor Crossover Tracker (5 min)            │                   │
│  │  • Monitor Trend Tracker (3 min)                │                   │
│  │  • Validate with Adaptive Logic                 │                   │
│  │  • Execute with Order Chasing                   │                   │
│  └─────────────────────────────────────────────────┘                   │
│       ↓                                                                 │
│  ┌─────────────────────┐                                               │
│  │  POSITION ENTERED   │                                               │
│  └─────────────────────┘                                               │
│       ↓                                                                 │
│  ┌─────────────────────────────────────────────────┐                   │
│  │  • Check Red Candle (instant)                   │                   │
│  │  • Check Profit Target                          │                   │
│  │  • Check Partial Exit Levels                    │                   │
│  │  • Update Sustained Momentum SL                 │                   │
│  │  • Update Trailing SL                           │                   │
│  └─────────────────────────────────────────────────┘                   │
│       ↓                                                                 │
│  ┌─────────────────────┐                                               │
│  │  POSITION EXITED    │                                               │
│  └─────────────────────┘                                               │
│       ↓                                                                 │
│  Log to Database                                                        │
│       ↓                                                                 │
│  Update UI                                                              │
│       ↓                                                                 │
│  Cooldown (5 sec)                                                       │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────┐
│                       KEY METRICS                                       │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  Crossover Tracker:                                                     │
│  ├─ Signal Timeout: 300 seconds (5 minutes)                            │
│  ├─ Momentum Threshold: 60% rising ticks                               │
│  └─ Acceleration Threshold: 2% gain                                    │
│                                                                         │
│  Trend Tracker:                                                         │
│  ├─ Signal Timeout: 180 seconds (3 minutes)                            │
│  ├─ Lookback Window: 10 candles                                        │
│  └─ Momentum Check: 3 ticks rising                                     │
│                                                                         │
│  Order Chasing:                                                         │
│  ├─ Chase Retries: 3 attempts                                          │
│  ├─ Chase Timeout: 200ms per attempt                                   │
│  └─ Market Fallback: Yes (after retries)                               │
│                                                                         │
│  Partial Exits:                                                         │
│  ├─ First Level: 20% profit                                            │
│  ├─ Exit Size: 50% of position                                         │
│  └─ Multiple Levels: Unlimited (until qty < lot_size)                  │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────┐
│                    AGGRESSIVENESS FACTORS                               │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  1. TIME WINDOWS                                                        │
│     • 5-minute crossover tracking = 300 seconds per signal             │
│     • 3-minute trend tracking = 180 seconds per signal                 │
│     • Continuous monitoring = checked every tick                       │
│     Result: 10× more chances to enter than before                      │
│                                                                         │
│  2. MULTIPLE SIGNAL SOURCES                                            │
│     • Instant signals (5 types)                                        │
│     • Crossover tracker (primary + alternative)                        │
│     • Trend tracker (continuations)                                    │
│     Result: 3× more signal types                                       │
│                                                                         │
│  3. LENIENT VALIDATION                                                 │
│     • Reversals bypass strict filters                                  │
│     • Lower momentum thresholds for trackers                           │
│     • Alternative sides also considered                                │
│     Result: 2× more signals pass validation                            │
│                                                                         │
│  4. FAST EXITS                                                         │
│     • Red candle = instant (no delay)                                  │
│     • Checked every tick (not just candle close)                       │
│     • Takes priority over all other exits                              │
│     Result: Smaller average losses                                     │
│                                                                         │
│  5. BETTER EXECUTION                                                   │
│     • Limit orders get better prices                                   │
│     • 3 retries with price updates                                     │
│     • Verification prevents errors                                     │
│     Result: 0.5-2 points better per trade                              │
│                                                                         │
│  OVERALL: 2-3× more trades, better risk management                     │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘

                           ╔═══════════════╗
                           ║   READY! 🚀   ║
                           ╚═══════════════╝
```
